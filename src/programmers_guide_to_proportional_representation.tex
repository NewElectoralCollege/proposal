\documentclass{article}
\usepackage[utf8]{inputenc}
\usepackage{listings}
\usepackage{xcolor}
\usepackage{geometry}

\definecolor{codegreen}{rgb}{0,0.6,0}
\definecolor{codepurple}{rgb}{0.58,0,0.82}

\geometry{legalpaper, portrait, margin=1in}

\lstdefinestyle{coding}{  
    commentstyle=\color{codegreen},
    keywordstyle=\color{blue},
    numberstyle=\tiny\color{gray},
    stringstyle=\color{codepurple},
    basicstyle=\ttfamily\footnotesize,
    breakatwhitespace=false,
    breaklines=false,
    captionpos=b,   
    keepspaces=true,
    numbers=left,   
    numbersep=5pt, 
    showspaces=false,       
    showstringspaces=false,
    showtabs=false, 
    tabsize=1
}

\lstset{style=coding}

\title{A Programmer's Guide to Proportional Representation}
\author{David G. Boers}

\begin{document}
    \maketitle
    
    \section{Introduction}

    Proportional Representation is best calculated on the computer. It is more efficient and more accurate than doing it by hand. This will contain several implementations of Proportional Representation.

    \section{Python}

    The results displayed on newelectoralcollege.com were computed using Python. Below are the basics of the implementation.

    \lstinputlisting[language=Python, firstline=96, lastline=133]{../../new_electoral_college_database/makeResults.py}

    You can view the full implementation at the GitHub repository: NewElectoralCollege/database.\\

    Python is very easy to read, meaning even people who aren't intimatly familiar with the language will be able to read it as Pseudocode. This makes Python the ideal langugage to write a calculator in, especialy if it needs to be open-source.\\

    That implementation is designed for the specific purpose of the New Electoral College's website. Below is another version created just for example.

    \lstinputlisting[language=Python]{../programming_examples/python.py}

    \section{C++}

    \lstinputlisting[language=C++]{../programming_examples/c++.cpp}

    \section{Purely Functional}

    Haskell is among the most widely used Purely Functional languages.

    \lstinputlisting[language=Haskell]{../programming_examples/Lrm.hs}

    The above implementation is very fast. It takes only two-thirds of the time that the Python implementation takes (on average), and only about 22\% (on average) of the time C++ takes.\\

    Here is a slight modification of the Haskell implementation with other quotas.

    \lstinputlisting[language=Haskell]{../programming_examples/LrmQuotas.hs}

    The implementation used for the Result Calculator on newelectoralcollege.com is written in Elm. This is not the same as the Python implementation above. That is used to calculate results in specific Presidential elections under The New Electoral College. This is used for the example calculator.

    \lstinputlisting[language=Haskell]{../../new_electoral_college/src/Calculator/Hare.elm}

    \section{Highest Averages Method}

    The other variant of Proportional Representation is the Highest Averages Method (HAM). The stated procedure for the variant is to divide each party's vote count by a successive set of divisors, with the top X number of divisors resulting in the respective party winning a seat. This approach is rarely used in practice however, because of the huge amount of memory it requires. \\

    Below is the C++ implementation involving all the divisors. 500 seats are calculated instead of just 5, in order to show the difference. \\

    \lstinputlisting[language=C++]{../programming_examples/ham1.cpp}

    Here is the C++ implementation involving only the required divisors. It takes on average a tenth of a second shorter than the previous version. The executable is also 26 KB smaller. Both programs were compiled using G++ 10.2.0 using C++ standard 17. \\

    \lstinputlisting[language=C++]{../programming_examples/ham2.cpp}

    \section{Fabricated Results}

    If one wishes to analyse Proportional Representation results, it is important to set up randomized results correctly. It is more complicated than just using a simple random number generator. The example calculator page on newelectoralcollege.com uses the following algorithm: \\

    Two parties recieve between 2 and 1,000,000 votes. Between zero and ten parties recieve between 2 and 100,000 votes, 100,000 being 10\% of the 1,000,000 that the larger two can recieve. This was built to model US elections, with two major parties having a huge advantage, with a couple of smaller parties. In fact, it is more generous than it should be, since achieving 10\% of the vote is extremely rare for smaller parties in the US. \\

    Below is the Elm code used on newelectoralcollege.com. \\

    \lstinputlisting[language=Haskell, firstline=119, lastline=154]{../../new_electoral_college/src/Calculator/Model.elm}

    Elm's official Random library is used above.

    \section{Gallagher Index}

    Below is an implementation of the Gallagher Index in Haskell.

    \lstinputlisting[language=Haskell]{../programming_examples/Gallagher.hs}

\end{document}